# 2025.12.8 Development Log (LangChain + FastAPI Chat Companion)

数据库/持久化梳理：补齐 ORM 模型与迁移（如果需要），确认 memori.db 的使用场景，避免生产写入 SQLite；为 Milvus 启动脚本增加健康检查与自动建表校验。


完成数据库/持久化和 Milvus 初始化梳理，并验证了测试。

主要改动：

ORM 补齐：backend/app/db/base.py 统一 declarative_base；db/models/user.py、chat_log.py 增加时间戳、角色字段、Memori 引用等必需字段。
持久化初始化：services/persistence/db.py 增加 init_db()，main.py 在启动时（dev 场景）自动建表，确保 metadata 就绪。
Memori 配置：config.py 默认不再强制 SQLite，MEMORI_STORAGE_URL 仅用于本地可选；.env.example 标注生产请使用真实数据库。
Milvus 脚本：infra/scripts/init_milvus.py 加入健康检查、可配置向量维度（EMBEDDING_DIM，默认 1536），自动建表/索引并加载集合。
依赖：requirements.txt 已包含 memori 依赖（继承上次改动）。



生产环境用真实数据库（PostgreSQL/MySQL），并用 Alembic 生成/管理迁移；在 dev 可保留自动 init_db()。
如需与 Memori 共用同一数据库，请为 MEMORI_STORAGE_URL 设定专用 DSN（非 SQLite），或在生产禁用本地存储让 Memori 自托管。