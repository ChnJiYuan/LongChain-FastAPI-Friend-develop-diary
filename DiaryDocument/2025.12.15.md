# 2025.12.15 Development Log (LangChain + FastAPI Chat Companion)

## Stable Diffusion Image Generation Verification

### Configuration Checklist
- `.env` settings: `SD_ENABLED=true`, `SD_BASE_URL=http://host.docker.internal:7860`, `IMAGE_PROVIDER=auto` (or `local`)
- API key: `MEMORI_API_KEY=qsnnb666` (configured in `.env`)

### Startup Steps

1. **Start Local SD WebUI API**
    - Run `webui-user.bat` with: `set COMMANDLINE_ARGS=--api --listen --port 7860`
    - Verify: `Invoke-RestMethod http://host.docker.internal:7860/sdapi/v1/sd-models`

2. **Start Membot**
    - Docker: `docker-compose up -d --build`
    - Local dev: `uvicorn app.main:app --reload --app-dir backend`

3. **Health Check**
    ```powershell
    Invoke-RestMethod -Headers @{ 'X-API-Key'='qsnnb666' } http://localhost:8000/api/v1/image/health
    ```
    Expected: `sd_enabled: true`, `sd_healthy: true`

4. **Test Image Generation**
    ```powershell
    $headers = @{ 'Content-Type'='application/json'; 'X-API-Key'='qsnnb666' }
    $body = @{ prompt = "a watercolor cat astronaut"; provider = "local" } | ConvertTo-Json
    Invoke-RestMethod -Method Post -Uri http://localhost:8000/api/v1/image -Headers $headers -Body $body
    ```

## End-to-End Workflow

### Environment Setup
- `API_PORT=18000`, `VITE_API_BASE_URL=http://localhost:18000`, `VITE_API_KEY=qsnnb666`
- SD WebUI running on port 7860 with `--api --listen`

### Deployment
```bash
docker-compose up -d --build
```

### Verification
- Backend: `Invoke-RestMethod http://localhost:18000/health`
- Frontend: Open `http://localhost:5173` â†’ test image generation in Image section

### Notes
- Rebuild frontend if needed: `docker-compose up -d --build frontend`
- Images currently return base64; add persistence layer if needed