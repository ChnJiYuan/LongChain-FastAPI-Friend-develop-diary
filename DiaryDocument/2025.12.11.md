# 2025.12.11 Development Log (LangChain + FastAPI Chat Companion)

## Planning

### Backend
- Add POST /api/v1/chat contract documentation and validation
- Integrate health check scripts or tests for Milvus/Memory interactions

### Database
- Update PostgreSQL service to use .env credentials
- Configure persistent volume names and data initialization scripts
- Evaluate default values for dev/prod environments

### Frontend
- Add loading states and retry experience (retry button, error logging)
- Provide runtime configuration hints or environment switching for VITE_API_BASE_URL

## Completed

### Chat API Contract Enhancement
- Strengthened POST /api/v1/chat: ChatRequest now validates user_id/message (whitespace trimming, length limits), max 5 non-empty images
- ChatResponse fields documented with unified milvus_chunks usage
- Added summary/description to route documentation

### Health Check Integration
- New GET /api/v1/memory/health endpoint returning memori/milvus/embedder status
- Avoids path conflicts with /memory/{user_id}
- Added test_memory_health.py with chat API contract and blank message validation tests

### PostgreSQL Configuration
- docker-compose.yml now driven by .env variables (POSTGRES_*)
- Persistent volume renamed to postgres-data
- Mounted infra/db/init.sql for schema/UUID extension/placeholder tables
- Updated .env.example, docs/env.md, and README.md with dev/prod guidance
- Added pytest.ini with pythonpath=backend

### Testing
- All pytest tests passing (backend/app/tests) ✅
- Note: transformers cache warnings in test logs

## Environment Configuration

**Development:** Use current .env.example defaults with docker-compose Postgres and init.sql
**Production:** Custom strong POSTGRES_* credentials, consider removing init.sql mount for migration tools/managed databases, set MEMORI_API_KEY if API key protection enabled



前端自检流程（按顺序跑一遍）：

安装&测试：在 frontend/ 执行 npm install（如未装）→ npm test（Vitest 已配置）→ npm run build 确认打包通过。
环境配置：确认 .env 的 VITE_API_BASE_URL 指向可用后端；若需要不同环境，启动前写 .env.local 覆盖。
启动联调：npm run dev -- --host --port 5173，浏览器访问，检查聊天消息可发出且回复显示，Memori/Milvus 区块随请求更新。
功能走查：空消息按钮应禁用；User ID 可编辑；后端断开或 URL 错误时有错误提示且按钮/状态恢复。
UI/适配：桌面/移动下布局是否正常，聊天列表滚动、空状态文案是否可见；控制台无报错。
无障碍/键盘：aria-label 已有，Tab 操作能覆盖输入/发送；焦点顺序合理。
依赖检查：package.json、锁文件无未安装依赖；如有变更，重新 npm install 再测。